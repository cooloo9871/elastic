apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- ../../base
- ./persistent-data.yaml
- ./namespace.yaml

#images:
#- name: docker.elastic.co/eck/eck-operator:3.0.0
#  newName: docph01.cbsd.scsb.com.tw/ocp4/elk/eck-operator
#  newTag: 3.0.0

patches:
- patch: |-
    - op: replace
      path: /spec/nodeAffinity/required/nodeSelectorTerms/0/matchExpressions/0/values/0
      value: crio-m1
    - op: replace
      path: /spec/nfs/path
      value: /es-master-nodes-0
    - op: replace
      path: /spec/nfs/server
      value: 172.20.2.10
  target:
    kind: PersistentVolume
    name: es-master-nodes-0
- patch: |-
    - op: replace
      path: /spec/nodeAffinity/required/nodeSelectorTerms/0/matchExpressions/0/values/0
      value: crio-m2
    - op: replace
      path: /spec/nfs/path
      value: /es-master-nodes-1
    - op: replace
      path: /spec/nfs/server
      value: 172.20.2.10
  target:
    kind: PersistentVolume
    name: es-master-nodes-1
- patch: |-
    - op: replace
      path: /spec/nodeAffinity/required/nodeSelectorTerms/0/matchExpressions/0/values/0
      value: crio-m3
    - op: replace
      path: /spec/nfs/path
      value: /es-master-nodes-2
    - op: replace
      path: /spec/nfs/server
      value: 172.20.2.10
  target:
    kind: PersistentVolume
    name: es-master-nodes-2
- patch: |-
    - op: replace
      path: /spec/nodeAffinity/required/nodeSelectorTerms/0/matchExpressions/0/values/0
      value: crio-m1
    - op: replace
      path: /spec/nfs/path
      value: /es-data-nodes-0
    - op: replace
      path: /spec/nfs/server
      value: 172.20.2.10
  target:
    kind: PersistentVolume
    name: es-data-nodes-0
- patch: |-
    - op: replace
      path: /spec/nodeAffinity/required/nodeSelectorTerms/0/matchExpressions/0/values/0
      value: crio-m2
    - op: replace
      path: /spec/nfs/path
      value: /es-data-nodes-1
    - op: replace
      path: /spec/nfs/server
      value: 172.20.2.10
  target:
    kind: PersistentVolume
    name: es-data-nodes-1
- patch: |-
    - op: replace
      path: /spec/nodeAffinity/required/nodeSelectorTerms/0/matchExpressions/0/values/0
      value: crio-m3
    - op: replace
      path: /spec/nfs/path
      value: /es-data-nodes-2
    - op: replace
      path: /spec/nfs/server
      value: 172.20.2.10
  target:
    kind: PersistentVolume
    name: es-data-nodes-2

- target:
    group: elasticsearch.k8s.elastic.co
    version: v1
    kind: Elasticsearch
    name: elasticsearch
  path: elastic-tolerations.json

patchesStrategicMerge:
  - kibana-patch.yaml
